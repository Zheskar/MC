@using ManaCena.Models
@using System.Reflection
@model List<Product>
@{
    ViewBag.Title = "EditProduct";
}

<h2>EditProduct</h2>



@*<input value="huj" id="asdf" />

<button onclick="aaa()">Click me</button>

<script type="text/javascript">
    function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#blah').attr('src', e.target.result);
            }

            reader.readAsDataURL(input.files[0]);
        }
    }

    function aaa() {
        alert($('#asdf').val());

    }

    //$('#imgInp').val();
    //$('#imgInp').change(function () {

    //    readURL(this);
    //});
</script>

<form id="form1" runat="server">
    <input type='file' id="imgInp" />
    <img id="blah" src="#" alt="your image" />
</form>*@


<table border="1">

    <tr>
        @*<td><label>Id</label></td>*@
        <td><label>Name</label></td>
        <td><label>Description</label></td>
        <td><label>Wheight</label></td>
        <td><label>Unit</label></td>
        <td><label>Size</label></td>
        <td><label>CathegoryId</label></td>
        <td><label>Description</label></td>
        <td><label>CathegoryType</label></td>
    </tr>

    @foreach (var p in Model)
    {
        var rnd = Guid.NewGuid();
        <tr>
            <td style="display:none;"><input value="@p.Id" id="@rnd-@nameof(Product.Id)" /></td>
            <td><img src="@p.ProductImage.Image" alt="" id="@rnd-@nameof(Product.ProductImage)"></td>
            <td><input value="@p.Name" id="@rnd-@nameof(Product.Name)" /></td>
            <td><input value="@p.Description" id="@rnd-@nameof(Product.Description)" /></td>
            <td><input value="@p.Wheight" id="@rnd-@nameof(Product.Wheight)" /></td>
            <td><input value="@p.Unit" id="@rnd-@nameof(Product.Unit)" /></td>
            <td><input value="@p.Size" id="@rnd-@nameof(Product.Size)" /></td>
            @*<td><input value="@p.CathegoryId" id="@rnd-@nameof(Product.CathegoryId)" /></td>*@
            @*<td><input value="@p.Cathegory.Name" id="@rnd-@nameof(Product.Cathegory)-@nameof(Cathegory.Name)" /></td>*@
            <td>
                <select id="@rnd-@nameof(Product.CathegoryId)">
                    @foreach (var ce in (List<Cathegory>)ViewBag.CathegoryEnum)
                    {
                        <option @if (ce.Id == p.CathegoryId) { <text> selected="selected" </text>   } value="@ce.Id">@ce.Name</option>
                    }
                </select>
            </td>
            <td><input value="@p.Description" id="@rnd-@nameof(Product.Cathegory)-@nameof(Cathegory.Name)" /></td>
            <td><input value="@p.Cathegory.CathegoryType.Name" id="@rnd-@nameof(Cathegory)-@nameof(CathegoryType)-@nameof(CathegoryType.Name)" /></td>
            <td>
                <button onclick="editProduct($('#@rnd-@nameof(Product.Id)').val(),
                                             $('#@rnd-@nameof(Product.Name)').val(),
                                             $('#@rnd-@nameof(Product.Description)').val(),
                                             $('#@rnd-@nameof(Product.Wheight)').val(),
                                             $('#@rnd-@nameof(Product.Unit)').val(),
                                             $('#@rnd-@nameof(Product.Size)').val(),
                                             $('#@rnd-@nameof(Product.CathegoryId)').val(),
                                             $('#@rnd-@nameof(Product.ProductImage)').attr('src')                                             
                                            )">
                    Edit
                </button>
            </td>
            <td></td>

        </tr>
    }

</table>

@section scripts {
    <script type="text/javascript">
        function editProduct(id, name, description, wheight, unit, size, cathegoryId, img) {
            alert(img);
            $.ajax({
                type: "POST",
                url: "/Product/EditItem",
                data: {
                    Id: id, Name: name, Description: description, Wheigh: wheight, Unit: unit, Size: size, CathegoryId: cathegoryId, ProductImage: { Image: img }
                },
                success: function (result) {
                    alert(result);
                    // Do something interesting here.
                }
            });
        }
    </script>

    <script type="text/javascript">

        function readURL(input) {

            if (input.files && input.files[0]) {
                var reader = new FileReader();

                reader.onload = function (e) {
                    $('#blah').attr('src', e.target.result);
                }

                reader.readAsDataURL(input.files[0]);
            }
        };

        $("#imgInp").change(function () {
            readURL(this);
        });

        function saveAAA() {
            $('#blah').attr('src');       
          
        };

    </script>

    
}



<form id="form1" runat="server">
    <input type='file' id="imgInp" />
    <img id="blah" src="#" alt="your image" />
</form>
